<!DOCTYPE html>
<html>
<head>
    <title>Stock Ticker</title>
    <link rel="style" href="clean.css">
</head>
<body>
    <canvas id="myChart"></canvas>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
      const ctx = document.getElementById('myChart').getContext('2d');
      const chart = new Chart(ctx, {
	  type: 'line',
	  data: {
	      labels: [],
	      datasets: [{
		  label: 'SPY Price',
		  data: [],
		  borderColor: 'rgb(75, 192, 192)',
		  tension: 0.2
	      }]
	  },
	  options: {
	      animation: false,
	      scales: {
		  x: { title: { display: true, text: 'Time' }},
		  y: { title: { display: true, text: 'Price ($)' }}
	      }
	  }
      });

      async function updateChart() {
	  const res = await fetch("/prices");
	  const data = await res.json();
	  const price = data["SPY"]; // pick your ticker
	  const now = new Date().toLocaleTimeString();

	  chart.data.labels.push(now);
	  chart.data.datasets[0].data.push(price);

	  if (chart.data.labels.length > 50) {
	      chart.data.labels.shift();
	      chart.data.datasets[0].data.shift();
	  }
	  chart.update();
      }
      setInterval(updateChart, 5000); // refresh every 5 seconds
    </script>

</body>
</html>
